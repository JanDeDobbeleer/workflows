name: Discord
on:
  workflow_call:
    secrets:
      webhook:
        description: 'Discord webhook'
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@a0853c24544627f65ddf259abe73b1d18a591444
      - run: npm install axios
      - name: Notes 📝
        id: notes
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd
        with:
          script: |
            const axios = require('axios');

            notes = context.payload.release.body

            // replace all non-supported characters
            notes = notes.replaceAll('###', '')
            notes = notes.trim()

            const options = {
              method: 'POST',
              url: "${{ secrets.webhook }}",
              headers: { 'Content-Type': 'application/json' },
              data: { content: notes }
            };

            axios
              .request(options)
              .then(() => {
                core.info('Message was sent successfully');
              });
