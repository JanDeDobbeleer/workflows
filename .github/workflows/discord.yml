name: Discord
on:
  workflow_call:
    secrets:
      webhook:
        description: 'Discord webhook'
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@8f152de45cc393bb48ce5d89d36b731f54556e65
      - run: npm install axios
      - name: Notes 📝
        id: notes
        uses: actions/github-script@d7906e4ad0b1822421a7e6a35d5ca353c962f410
        with:
          script: |
            const axios = require('axios');

            notes = context.payload.release.body

            // replace all non-supported characters
            notes = notes.replaceAll('###', '')
            notes = notes.trim()

            const options = {
              method: 'POST',
              url: "${{ secrets.webhook }}",
              headers: { 'Content-Type': 'application/json' },
              data: { content: notes }
            };

            axios
              .request(options)
              .then(() => {
                core.info('Message was sent successfully');
              });
